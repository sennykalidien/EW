"use strict";function _defineProperty(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}var APP=APP||{};APP.launcher=function(){function e(){document.addEventListener("DOMContentLoaded",function(){APP.geo.getLocation()})}return{init:e}}(),APP.launcher.init(),APP.data=function(e){function t(e){var t=this;return new Promise(function(o,n){var i=new XMLHttpRequest;i.open("GET",e,!0),i.onload=function(){t.status>=200&&t.status<300?o(i.response):n({status:t.status,statusText:i.statusText})},i.onerror=function(){n({status:t.status,statusText:i.statusText})},i.send()})}function o(e){var t="json",o="e2d60e885b8742d4b0648300e3703bd7",n="koop",e=e,i="1",a="25",r="http://funda.kyrandia.nl/feeds/Aanbod.svc/"+t+"/"+o+"/?type="+n+"&zo=/"+e+"&page="+i+"&pagesize="+a;this.request(r).then(function(t){var o=JSON.parse(t),n=[];o.Objects.forEach(function(e){if(1==e.HeeftVideo){var t={id:e.Id};n.push(t)}}),APP.router.init(n,e)})}function n(e){var t="json",o="e2d60e885b8742d4b0648300e3703bd7",n="koop",e=e,i="1",a="25",r="http://funda.kyrandia.nl/feeds/Aanbod.svc/"+t+"/"+o+"/?type="+n+"&zo=/"+e+"&page="+i+"&pagesize="+a;this.request(r).then(function(e){var t=JSON.parse(e),o=[];[].forEach.call(t.Objects,function(e){var t={id:e.Id,title:e.Adres,photo:e.FotoLargest,postalcode:e.Postcode,place:e.Woonplaats,price:e.Prijs.Koopprijs};o.push(t)}),APP.page.houseFavourites(o)})}function i(e){var t="json",o="e2d60e885b8742d4b0648300e3703bd7",e=e,n="koop",i="http://funda.kyrandia.nl/feeds/Aanbod.svc/"+t+"/detail/"+o+"/"+n+"/"+e+"/";this.request(i).then(function(e){var t,o,n,i=JSON.parse(e),a=[];for(t=0;t<i.Media.length-12;t++)o=i.Media[t],void 0!=o.MediaItems[3]&&(n=o.MediaItems[3].Url),a.push({photo:n});var r=[],s={id:i.InternalId,title:i.Titels[0].Omschrijving,photos:a,description:i.VolledigeOmschrijving,price:i.KoopPrijs,url:i.URL};r.push(s),APP.page.houseDetail(r)})}function a(e,t){var o="json",n="e2d60e885b8742d4b0648300e3703bd7",e=e,i="koop",a="http://funda.kyrandia.nl/feeds/Aanbod.svc/"+o+"/detail/"+n+"/"+i+"/"+e+"/";this.request(a).then(function(o){var n=JSON.parse(o),i=function(o){var n=0,i=t.length;for(n;i>n;n+=1)if(t[n].id===e)return t[n+1];return"not found"},a=function(o){var n=0,i=t.length;for(n;i>n;n+=1)if(t[n].id===e)return t[n-1];return"not found"},r=i(e),s=a(e);if(void 0==s)var u={id:e,nextID:r.id,title:n.Titels[0].Omschrijving,buyPrice:n.Prijs.Koopprijs,videoURL:n.Video.Videos[0].Cdns[0].Url};else if(void 0==r)var u={id:e,prevID:s.id,title:n.Titels[0].Omschrijving,buyPrice:n.Prijs.Koopprijs,videoURL:n.Video.Videos[0].Cdns[0].Url};else var u={id:e,nextID:r.id,prevID:s.id,title:n.Titels[0].Omschrijving,buyPrice:n.Prijs.Koopprijs,videoURL:n.Video.Videos[0].Cdns[0].Url};APP.page.houseVideo(u)})}return _defineProperty({request:t,getHouses:o,getHouseFavourites:n,getHouseVideo:a,getHouseDetail:i},"getHouseDetail",i)}(),APP.geo=function(){function e(){navigator.geolocation&&navigator.geolocation.getCurrentPosition(t,o,{enableHighAccuracy:!0,maximumAge:0})}function t(e){var t=["https://nominatim.openstreetmap.org/reverse?format=json&lat=","&lon="],o=e.coords.latitude,n=e.coords.longitude,i="&zoom=13&addressdetails=1",a=t[0]+o+t[1]+n+i;APP.data.request(a).then(function(e){var t=JSON.parse(e),o=t.address.city||t.address.town;localStorage.setItem("Location",o),console.log(o),APP.data.getHouses(o)})}function o(){console.log("an error has occured")}return{getLocation:e}}(),APP.page=function(){function e(e){APP.data.request("./dist/templates/house-videos.mst").then(function(t){n.innerHTML=Mustache.render(t,e),i.classList.remove("active"),APP.storage.init()})}function t(e){APP.data.request("./dist/templates/house-detail.mst").then(function(t){n.innerHTML=Mustache.render(t,e),i.classList.remove("active")})}function o(e){if(null!=localStorage.getItem("houseID"))var t=localStorage.getItem("houseID");else var t=[];var e=e.filter(function(e){return-1!=t.indexOf(e.id)});console.log(e),APP.data.request("./dist/templates/house-favourites.mst").then(function(t){n.innerHTML=Mustache.render(t,e),i.classList.remove("active"),APP.storage.init()})}var n=document.querySelector("main"),i=document.getElementById("loader");return{houseVideo:e,houseDetail:t,houseFavourites:o}}(),APP.router=function(){function e(e,t){window.location.hash||(window.location="#videoID="+e[0].id),routie({"videoID=:ID":function(t){APP.data.getHouseVideo(t,e)},"houseDetail=:ID":function(e){APP.data.getHouseDetail(e)},favourites:function(){APP.data.getHouseFavourites(t)}})}return{init:e}}(),APP.storage=function(){function e(){function e(e){e.preventDefault();var n=this.getAttribute("value");t.push(n),this.classList.remove("active");for(var i=0;i<o.length;i++){for(var a=o[i],r=0,s=0;s<o.length;s++)o[s]==t[i]&&r++;if(r>1)for(var u=0;u<o.length;u++)o[u]==a&&(o.splice(u,1),u-=1)}[].forEach.call(o,function(e){var t=document.querySelector('.favourite-btn[value="'+e+'"]');t&&t.classList.add("active")}),localStorage.setItem("houseID",JSON.stringify(o))}if(null===localStorage.getItem("houseID")||""===localStorage.getItem("houseID"))var t=[];else var t=JSON.parse(localStorage.getItem("houseID"));var o=t,n=document.querySelectorAll(".favourite-btn");[].forEach.call(o,function(e){var t=document.querySelector('.favourite-btn[value="'+e+'"]');t&&t.classList.add("active")}),[].forEach.call(n,function(t){t.addEventListener("click",e,!1)})}return{init:e}}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5taW4uanMiLCJhcHAuanMiLCJkYXRhLmpzIiwiZ2VvLmpzIiwicGFnZXMuanMiLCJyb3V0ZXIuanMiLCJzdG9yYWdlLmpzIl0sIm5hbWVzIjpbIl9kZWZpbmVQcm9wZXJ0eSIsIm9iaiIsImtleSIsInZhbHVlIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJlbnVtZXJhYmxlIiwiY29uZmlndXJhYmxlIiwid3JpdGFibGUiLCJBUFAiLCJsYXVuY2hlciIsImluaXQiLCJkb2N1bWVudCIsImFkZEV2ZW50TGlzdGVuZXIiLCJnZW8iLCJnZXRMb2NhdGlvbiIsImRhdGEiLCJjaXR5IiwicmVxdWVzdCIsInVybCIsIl90aGlzIiwidGhpcyIsIlByb21pc2UiLCJyZXNvbHZlIiwicmVqZWN0IiwieGhyIiwiWE1MSHR0cFJlcXVlc3QiLCJvcGVuIiwib25sb2FkIiwic3RhdHVzIiwicmVzcG9uc2UiLCJzdGF0dXNUZXh0Iiwib25lcnJvciIsInNlbmQiLCJnZXRIb3VzZXMiLCJvYmplY3RUeXBlIiwiYXBpS2V5IiwidHlwZSIsInBhZ2VOdW1iZXIiLCJwYWdlU2l6ZSIsImFwaVVSTCIsInRoZW4iLCJob3VzZURhdGEiLCJKU09OIiwicGFyc2UiLCJob3VzZUlEcyIsIk9iamVjdHMiLCJmb3JFYWNoIiwiaG91c2UiLCJIZWVmdFZpZGVvIiwiSURzIiwiaWQiLCJJZCIsInB1c2giLCJyb3V0ZXIiLCJnZXRIb3VzZUZhdm91cml0ZXMiLCJjYWxsIiwib2JqZWN0Iiwib2JqZWN0cyIsInRpdGxlIiwiQWRyZXMiLCJwaG90byIsIkZvdG9MYXJnZXN0IiwicG9zdGFsY29kZSIsIlBvc3Rjb2RlIiwicGxhY2UiLCJXb29ucGxhYXRzIiwicHJpY2UiLCJQcmlqcyIsIktvb3BwcmlqcyIsInBhZ2UiLCJob3VzZUZhdm91cml0ZXMiLCJnZXRIb3VzZURldGFpbCIsIklEIiwiaSIsIm1lZGlhIiwibGFyZ2VQaG90b3NVcmwiLCJwaG90b3MiLCJNZWRpYSIsImxlbmd0aCIsInVuZGVmaW5lZCIsIk1lZGlhSXRlbXMiLCJVcmwiLCJJbnRlcm5hbElkIiwiVGl0ZWxzIiwiT21zY2hyaWp2aW5nIiwiZGVzY3JpcHRpb24iLCJWb2xsZWRpZ2VPbXNjaHJpanZpbmciLCJLb29wUHJpanMiLCJVUkwiLCJob3VzZURldGFpbCIsImdldEhvdXNlVmlkZW8iLCJob3VzZURldGFpbERhdGEiLCJuZXh0SXRlbSIsIm1heCIsInByZXZJdGVtIiwibmV4dElEIiwicHJldklEIiwiYnV5UHJpY2UiLCJ2aWRlb1VSTCIsIlZpZGVvIiwiVmlkZW9zIiwiQ2RucyIsImhvdXNlVmlkZW8iLCJuYXZpZ2F0b3IiLCJnZW9sb2NhdGlvbiIsImdldEN1cnJlbnRQb3NpdGlvbiIsIl9kaXNwbGF5UG9zaXRpb24iLCJfZGlzcGxheUVycm9yIiwiZW5hYmxlSGlnaEFjY3VyYWN5IiwibWF4aW11bUFnZSIsInBvc2l0aW9uIiwiZ3BzVG9DaXR5IiwibGF0IiwiY29vcmRzIiwibGF0aXR1ZGUiLCJsb24iLCJsb25naXR1ZGUiLCJ6b29tIiwiQ2l0eVVybCIsImNpdHlEYXRhIiwiYWRkcmVzcyIsInRvd24iLCJsb2NhbFN0b3JhZ2UiLCJzZXRJdGVtIiwiY29uc29sZSIsImxvZyIsInRlbXBsYXRlIiwiX21haW5TZWxlY3RvciIsImlubmVySFRNTCIsIk11c3RhY2hlIiwicmVuZGVyIiwiX2xvYWRlciIsImNsYXNzTGlzdCIsInJlbW92ZSIsInN0b3JhZ2UiLCJnZXRJdGVtIiwiZmlsdGVyIiwiYyIsImluZGV4T2YiLCJxdWVyeVNlbGVjdG9yIiwiZ2V0RWxlbWVudEJ5SWQiLCJ3aW5kb3ciLCJsb2NhdGlvbiIsImhhc2giLCJyb3V0aWUiLCJ2aWRlb0lEPTpJRCIsImhvdXNlRGV0YWlsPTpJRCIsImZhdm91cml0ZXMiLCJzdG9yZUlEIiwiZXZlbnQiLCJwcmV2ZW50RGVmYXVsdCIsImNsaWNrZWRJRCIsImdldEF0dHJpYnV0ZSIsImFycmF5SUQiLCJoIiwibmV3QXJyYXlJRCIsImN1ckl0ZW0iLCJmb3VuZENvdW50IiwiaiIsInNwbGljZSIsIl9mYXZvdXJpdGVCdXR0b25JRCIsImFkZCIsInN0cmluZ2lmeSIsIl9mYXZvdXJpdGVCdXR0b24iLCJxdWVyeVNlbGVjdG9yQWxsIiwiYnV0dG9uIl0sIm1hcHBpbmdzIjoiQUFBQSxZQTJCQSxTQUFTQSxpQkFBZ0JDLEVBQUtDLEVBQUtDLEdBQWlLLE1BQXBKRCxLQUFPRCxHQUFPRyxPQUFPQyxlQUFlSixFQUFLQyxHQUFPQyxNQUFPQSxFQUFPRyxZQUFZLEVBQU1DLGNBQWMsRUFBTUMsVUFBVSxJQUFrQlAsRUFBSUMsR0FBT0MsRUFBZ0JGLEVDeEIzTSxHQUFJUSxLQUFNQSxPQU1WQSxLQUFJQyxTQUFZLFdBRVosUUFBU0MsS0FDTEMsU0FBU0MsaUJBQWlCLG1CQUFvQixXQUMxQ0osSUFBSUssSUFBSUMsZ0JBSWhCLE9BQ0lKLEtBQU1BLE1BS2RGLElBQUlDLFNBQVNDLE9DcEJiRixJQUFJTyxLQUFTLFNBQUNDLEdBQ1YsUUFBU0MsR0FBUUMsR0FBSyxHQUFBQyxHQUFBQyxJQUNsQixPQUFPLElBQUlDLFNBQVEsU0FBQ0MsRUFBU0MsR0FDekIsR0FBSUMsR0FBTSxHQUFJQyxlQUNkRCxHQUFJRSxLQUFLLE1BQU9SLEdBQUssR0FDckJNLEVBQUlHLE9BQVUsV0FDTlIsRUFBS1MsUUFBVSxLQUFPVCxFQUFLUyxPQUFTLElBQ3BDTixFQUFRRSxFQUFJSyxVQUVaTixHQUNJSyxPQUFRVCxFQUFLUyxPQUNiRSxXQUFZTixFQUFJTSxjQUk1Qk4sRUFBSU8sUUFBVyxXQUNYUixHQUNJSyxPQUFRVCxFQUFLUyxPQUNiRSxXQUFZTixFQUFJTSxjQUd4Qk4sRUFBSVEsU0FJWixRQUFTQyxHQUFVakIsR0FDZixHQUFJa0IsR0FBYSxPQUNiQyxFQUFTLG1DQUNUQyxFQUFPLE9BQ1BwQixFQUFPQSxFQUNQcUIsRUFBYSxJQUNiQyxFQUFXLEtBQ1hDLEVBQVMsNkNBQThDTCxFQUFhLElBQUtDLEVBQVMsVUFBWUMsRUFBTyxRQUFVcEIsRUFBTyxTQUFXcUIsRUFBYSxhQUFlQyxD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QUFtQjVCLFVBQVU2QixJQUFJLFlBS25DdkMsYUFBYUMsUUFBUSxVQUFXakYsS0FBS3dILFVBQVVQLElBL0Q3QyxHQUF3QyxPQUFwQ2pDLGFBQWFhLFFBQVEsWUFBMkQsS0FBcENiLGFBQWFhLFFBQVEsV0FDakUsR0FBSWtCLFVBRUosSUFBSUEsR0FBVS9HLEtBQUtDLE1BQU0rRSxhQUFhYSxRQUFRLFdBSWxELElBQUlvQixHQUFhRixFQUdoQlUsRUFBbUJ4SixTQUFTeUosaUJBQWlCLHFCQUc5Q3RILFFBQVFTLEtBQUtvRyxFQUFZLFNBQUNuRixHQUM1QixHQUFJd0YsR0FBcUJySixTQUFTZ0ksY0FBYyx5QkFBMkJuRSxFQUFLLEtBQzdFd0YsSUFDRkEsRUFBbUI1QixVQUFVNkIsSUFBSSxlQUtoQ25ILFFBQVFTLEtBQUs0RyxFQUFrQixTQUFDRSxHQUV6QkEsRUFBT3pKLGlCQUFpQixRQUFTd0ksR0FBUyxLQTRDckQsT0FDTzFJLEtBQU1BIiwiZmlsZSI6ImFwcC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcblxuLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxuXHROQU1FU1BBQ0VcbioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi9cbnZhciBBUFAgPSBBUFAgfHwge307XG4ndXNlIHN0cmljdCc7XG5cbi8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcbiAgICBMQVVOQ0ggQVBQXG4qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovXG5BUFAubGF1bmNoZXIgPSBmdW5jdGlvbiAoKSB7XG5cbiAgICBmdW5jdGlvbiBpbml0KCkge1xuICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwiRE9NQ29udGVudExvYWRlZFwiLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBBUFAuZ2VvLmdldExvY2F0aW9uKCk7XG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICByZXR1cm4ge1xuICAgICAgICBpbml0OiBpbml0XG4gICAgfTtcbn0oKTtcblxuQVBQLmxhdW5jaGVyLmluaXQoKTtcbid1c2Ugc3RyaWN0JztcblxuZnVuY3Rpb24gX2RlZmluZVByb3BlcnR5KG9iaiwga2V5LCB2YWx1ZSkgeyBpZiAoa2V5IGluIG9iaikgeyBPYmplY3QuZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHsgdmFsdWU6IHZhbHVlLCBlbnVtZXJhYmxlOiB0cnVlLCBjb25maWd1cmFibGU6IHRydWUsIHdyaXRhYmxlOiB0cnVlIH0pOyB9IGVsc2UgeyBvYmpba2V5XSA9IHZhbHVlOyB9IHJldHVybiBvYmo7IH1cblxuLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxuXHREQVRBIFJFUVVFU1RcbioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi9cbkFQUC5kYXRhID0gZnVuY3Rpb24gKGNpdHkpIHtcbiAgICBmdW5jdGlvbiByZXF1ZXN0KHVybCkge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuXG4gICAgICAgIC8vIHNyYzogaHR0cDovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy8zMDAwODExNC9ob3ctZG8taS1wcm9taXNpZnktbmF0aXZlLXhoclxuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICAgICAgdmFyIHhociA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xuICAgICAgICAgICAgeGhyLm9wZW4oJ0dFVCcsIHVybCwgdHJ1ZSk7XG4gICAgICAgICAgICB4aHIub25sb2FkID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGlmIChfdGhpcy5zdGF0dXMgPj0gMjAwICYmIF90aGlzLnN0YXR1cyA8IDMwMCkge1xuICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHhoci5yZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1czogX3RoaXMuc3RhdHVzLFxuICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzVGV4dDogeGhyLnN0YXR1c1RleHRcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHhoci5vbmVycm9yID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJlamVjdCh7XG4gICAgICAgICAgICAgICAgICAgIHN0YXR1czogX3RoaXMuc3RhdHVzLFxuICAgICAgICAgICAgICAgICAgICBzdGF0dXNUZXh0OiB4aHIuc3RhdHVzVGV4dFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHhoci5zZW5kKCk7XG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICBmdW5jdGlvbiBnZXRIb3VzZXMoY2l0eSkge1xuICAgICAgICB2YXIgb2JqZWN0VHlwZSA9ICdqc29uJyxcbiAgICAgICAgICAgIGFwaUtleSA9ICdlMmQ2MGU4ODViODc0MmQ0YjA2NDgzMDBlMzcwM2JkNycsXG4gICAgICAgICAgICB0eXBlID0gJ2tvb3AnLFxuICAgICAgICAgICAgY2l0eSA9IGNpdHksXG4gICAgICAgICAgICBwYWdlTnVtYmVyID0gJzEnLFxuICAgICAgICAgICAgcGFnZVNpemUgPSAnMjUnLFxuICAgICAgICAgICAgYXBpVVJMID0gJ2h0dHA6Ly9mdW5kYS5reXJhbmRpYS5ubC9mZWVkcy9BYW5ib2Quc3ZjLycgKyBvYmplY3RUeXBlICsgJy8nICsgYXBpS2V5ICsgJy8/dHlwZT0nICsgdHlwZSArICcmem89LycgKyBjaXR5ICsgJyZwYWdlPScgKyBwYWdlTnVtYmVyICsgJyZwYWdlc2l6ZT0nICsgcGFnZVNpemUgKyAnJztcblxuICAgICAgICB0aGlzLnJlcXVlc3QoYXBpVVJMKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgdmFyIGhvdXNlRGF0YSA9IEpTT04ucGFyc2UocmVzcG9uc2UpO1xuICAgICAgICAgICAgdmFyIGhvdXNlSURzID0gW107XG5cbiAgICAgICAgICAgIC8vIFtdLmZvckVhY2guY2FsbChob3VzZURhdGEuT2JqZWN0cywoaG91c2UpID0+IHtcbiAgICAgICAgICAgIC8vICAgICBpZihob3VzZS5IZWVmdFZpZGVvID09IHRydWUpIHtcbiAgICAgICAgICAgIC8vICAgICAgICAgdmFyIElEcyA9IHtcbiAgICAgICAgICAgIC8vICAgICAgICAgICAgIGlkOiBob3VzZS5JZFxuICAgICAgICAgICAgLy8gICAgICAgICB9O1xuICAgICAgICAgICAgLy8gICAgICAgICBob3VzZUlEcy5wdXNoKElEcyk7XG4gICAgICAgICAgICAvLyAgICAgfVxuICAgICAgICAgICAgLy8gfSk7XG5cbiAgICAgICAgICAgIGhvdXNlRGF0YS5PYmplY3RzLmZvckVhY2goZnVuY3Rpb24gKGhvdXNlKSB7XG4gICAgICAgICAgICAgICAgaWYgKGhvdXNlLkhlZWZ0VmlkZW8gPT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgSURzID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IGhvdXNlLklkXG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgIGhvdXNlSURzLnB1c2goSURzKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgQVBQLnJvdXRlci5pbml0KGhvdXNlSURzLCBjaXR5KTtcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIGZ1bmN0aW9uIGdldEhvdXNlRmF2b3VyaXRlcyhjaXR5KSB7XG4gICAgICAgIHZhciBvYmplY3RUeXBlID0gJ2pzb24nLFxuICAgICAgICAgICAgYXBpS2V5ID0gJ2UyZDYwZTg4NWI4NzQyZDRiMDY0ODMwMGUzNzAzYmQ3JyxcbiAgICAgICAgICAgIHR5cGUgPSAna29vcCcsXG4gICAgICAgICAgICBjaXR5ID0gY2l0eSxcbiAgICAgICAgICAgIHBhZ2VOdW1iZXIgPSAnMScsXG4gICAgICAgICAgICBwYWdlU2l6ZSA9ICcyNScsXG4gICAgICAgICAgICBhcGlVUkwgPSAnaHR0cDovL2Z1bmRhLmt5cmFuZGlhLm5sL2ZlZWRzL0FhbmJvZC5zdmMvJyArIG9iamVjdFR5cGUgKyAnLycgKyBhcGlLZXkgKyAnLz90eXBlPScgKyB0eXBlICsgJyZ6bz0vJyArIGNpdHkgKyAnJnBhZ2U9JyArIHBhZ2VOdW1iZXIgKyAnJnBhZ2VzaXplPScgKyBwYWdlU2l6ZSArICcnO1xuXG4gICAgICAgIHRoaXMucmVxdWVzdChhcGlVUkwpLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICB2YXIgaG91c2VEYXRhID0gSlNPTi5wYXJzZShyZXNwb25zZSk7XG5cbiAgICAgICAgICAgIHZhciBkYXRhID0gW107XG5cbiAgICAgICAgICAgIFtdLmZvckVhY2guY2FsbChob3VzZURhdGEuT2JqZWN0cywgZnVuY3Rpb24gKG9iamVjdCkge1xuICAgICAgICAgICAgICAgIHZhciBvYmplY3RzID0ge1xuICAgICAgICAgICAgICAgICAgICBpZDogb2JqZWN0LklkLFxuICAgICAgICAgICAgICAgICAgICB0aXRsZTogb2JqZWN0LkFkcmVzLFxuICAgICAgICAgICAgICAgICAgICBwaG90bzogb2JqZWN0LkZvdG9MYXJnZXN0LFxuICAgICAgICAgICAgICAgICAgICBwb3N0YWxjb2RlOiBvYmplY3QuUG9zdGNvZGUsXG4gICAgICAgICAgICAgICAgICAgIHBsYWNlOiBvYmplY3QuV29vbnBsYWF0cyxcbiAgICAgICAgICAgICAgICAgICAgcHJpY2U6IG9iamVjdC5Qcmlqcy5Lb29wcHJpanNcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIGRhdGEucHVzaChvYmplY3RzKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBBUFAucGFnZS5ob3VzZUZhdm91cml0ZXMoZGF0YSk7XG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICBmdW5jdGlvbiBnZXRIb3VzZURldGFpbChJRCkge1xuICAgICAgICB2YXIgb2JqZWN0VHlwZSA9ICdqc29uJyxcbiAgICAgICAgICAgIGFwaUtleSA9ICdlMmQ2MGU4ODViODc0MmQ0YjA2NDgzMDBlMzcwM2JkNycsXG4gICAgICAgICAgICBJRCA9IElELFxuICAgICAgICAgICAgdHlwZSA9ICdrb29wJyxcbiAgICAgICAgICAgIGFwaVVSTCA9ICdodHRwOi8vZnVuZGEua3lyYW5kaWEubmwvZmVlZHMvQWFuYm9kLnN2Yy8nICsgb2JqZWN0VHlwZSArICcvZGV0YWlsLycgKyBhcGlLZXkgKyAnLycgKyB0eXBlICsgJy8nICsgSUQgKyAnLyc7XG5cbiAgICAgICAgdGhpcy5yZXF1ZXN0KGFwaVVSTCkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgIHZhciBob3VzZURhdGEgPSBKU09OLnBhcnNlKHJlc3BvbnNlKTtcblxuICAgICAgICAgICAgdmFyIGksIG1lZGlhLCBqLCBtZWRpYUl0ZW1zLCBsYXJnZVBob3Rvc1VybDtcbiAgICAgICAgICAgIHZhciBwaG90b3MgPSBbXTtcbiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBob3VzZURhdGEuTWVkaWEubGVuZ3RoIC0gMTI7IGkrKykge1xuICAgICAgICAgICAgICAgIG1lZGlhID0gaG91c2VEYXRhLk1lZGlhW2ldO1xuICAgICAgICAgICAgICAgIGlmIChtZWRpYS5NZWRpYUl0ZW1zWzNdICE9IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICBsYXJnZVBob3Rvc1VybCA9IG1lZGlhLk1lZGlhSXRlbXNbM10uVXJsO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBwaG90b3MucHVzaCh7IHBob3RvOiBsYXJnZVBob3Rvc1VybCB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIGRhdGEgPSBbXTtcbiAgICAgICAgICAgIHZhciBvYmplY3RzID0ge1xuICAgICAgICAgICAgICAgIGlkOiBob3VzZURhdGEuSW50ZXJuYWxJZCxcbiAgICAgICAgICAgICAgICB0aXRsZTogaG91c2VEYXRhLlRpdGVsc1swXS5PbXNjaHJpanZpbmcsXG4gICAgICAgICAgICAgICAgcGhvdG9zOiBwaG90b3MsXG4gICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IGhvdXNlRGF0YS5Wb2xsZWRpZ2VPbXNjaHJpanZpbmcsXG4gICAgICAgICAgICAgICAgcHJpY2U6IGhvdXNlRGF0YS5Lb29wUHJpanMsXG4gICAgICAgICAgICAgICAgdXJsOiBob3VzZURhdGEuVVJMXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgZGF0YS5wdXNoKG9iamVjdHMpO1xuXG4gICAgICAgICAgICBBUFAucGFnZS5ob3VzZURldGFpbChkYXRhKTtcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIGZ1bmN0aW9uIGdldEhvdXNlVmlkZW8oSUQsIGhvdXNlSURzKSB7XG4gICAgICAgIHZhciBvYmplY3RUeXBlID0gJ2pzb24nLFxuICAgICAgICAgICAgYXBpS2V5ID0gJ2UyZDYwZTg4NWI4NzQyZDRiMDY0ODMwMGUzNzAzYmQ3JyxcbiAgICAgICAgICAgIElEID0gSUQsXG4gICAgICAgICAgICB0eXBlID0gJ2tvb3AnLFxuICAgICAgICAgICAgYXBpVVJMID0gJ2h0dHA6Ly9mdW5kYS5reXJhbmRpYS5ubC9mZWVkcy9BYW5ib2Quc3ZjLycgKyBvYmplY3RUeXBlICsgJy9kZXRhaWwvJyArIGFwaUtleSArICcvJyArIHR5cGUgKyAnLycgKyBJRCArICcvJztcblxuICAgICAgICB0aGlzLnJlcXVlc3QoYXBpVVJMKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgdmFyIGhvdXNlRGV0YWlsRGF0YSA9IEpTT04ucGFyc2UocmVzcG9uc2UpO1xuXG4gICAgICAgICAgICAvLyBHZXQgbmV4dCBJRCBpbiBhcnJheVxuICAgICAgICAgICAgdmFyIG5leHRJdGVtID0gZnVuY3Rpb24gbmV4dEl0ZW0oaWQpIHtcbiAgICAgICAgICAgICAgICB2YXIgaSA9IDAsXG4gICAgICAgICAgICAgICAgICAgIG1heCA9IGhvdXNlSURzLmxlbmd0aDtcblxuICAgICAgICAgICAgICAgIGZvciAoaTsgaSA8IG1heDsgaSArPSAxKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChob3VzZUlEc1tpXS5pZCA9PT0gSUQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBob3VzZUlEc1tpICsgMV07XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuICdub3QgZm91bmQnO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgLy8gR2V0IHByZXYgSUQgaW4gYXJyYXlcbiAgICAgICAgICAgIHZhciBwcmV2SXRlbSA9IGZ1bmN0aW9uIHByZXZJdGVtKGlkKSB7XG4gICAgICAgICAgICAgICAgdmFyIGkgPSAwLFxuICAgICAgICAgICAgICAgICAgICBtYXggPSBob3VzZUlEcy5sZW5ndGg7XG5cbiAgICAgICAgICAgICAgICBmb3IgKGk7IGkgPCBtYXg7IGkgKz0gMSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoaG91c2VJRHNbaV0uaWQgPT09IElEKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaG91c2VJRHNbaSAtIDFdO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiAnbm90IGZvdW5kJztcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBuZXh0SUQgPSBuZXh0SXRlbShJRCk7XG4gICAgICAgICAgICB2YXIgcHJldklEID0gcHJldkl0ZW0oSUQpO1xuXG4gICAgICAgICAgICBpZiAocHJldklEID09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIHZhciBkYXRhID0ge1xuICAgICAgICAgICAgICAgICAgICBpZDogSUQsXG4gICAgICAgICAgICAgICAgICAgIG5leHRJRDogbmV4dElELmlkLFxuICAgICAgICAgICAgICAgICAgICB0aXRsZTogaG91c2VEZXRhaWxEYXRhLlRpdGVsc1swXS5PbXNjaHJpanZpbmcsXG4gICAgICAgICAgICAgICAgICAgIGJ1eVByaWNlOiBob3VzZURldGFpbERhdGEuUHJpanMuS29vcHByaWpzLFxuICAgICAgICAgICAgICAgICAgICB2aWRlb1VSTDogaG91c2VEZXRhaWxEYXRhLlZpZGVvLlZpZGVvc1swXS5DZG5zWzBdLlVybFxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9IGVsc2UgaWYgKG5leHRJRCA9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICB2YXIgZGF0YSA9IHtcbiAgICAgICAgICAgICAgICAgICAgaWQ6IElELFxuICAgICAgICAgICAgICAgICAgICBwcmV2SUQ6IHByZXZJRC5pZCxcbiAgICAgICAgICAgICAgICAgICAgdGl0bGU6IGhvdXNlRGV0YWlsRGF0YS5UaXRlbHNbMF0uT21zY2hyaWp2aW5nLFxuICAgICAgICAgICAgICAgICAgICBidXlQcmljZTogaG91c2VEZXRhaWxEYXRhLlByaWpzLktvb3BwcmlqcyxcbiAgICAgICAgICAgICAgICAgICAgdmlkZW9VUkw6IGhvdXNlRGV0YWlsRGF0YS5WaWRlby5WaWRlb3NbMF0uQ2Ruc1swXS5VcmxcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB2YXIgZGF0YSA9IHtcbiAgICAgICAgICAgICAgICAgICAgaWQ6IElELFxuICAgICAgICAgICAgICAgICAgICBuZXh0SUQ6IG5leHRJRC5pZCxcbiAgICAgICAgICAgICAgICAgICAgcHJldklEOiBwcmV2SUQuaWQsXG4gICAgICAgICAgICAgICAgICAgIHRpdGxlOiBob3VzZURldGFpbERhdGEuVGl0ZWxzWzBdLk9tc2NocmlqdmluZyxcbiAgICAgICAgICAgICAgICAgICAgYnV5UHJpY2U6IGhvdXNlRGV0YWlsRGF0YS5Qcmlqcy5Lb29wcHJpanMsXG4gICAgICAgICAgICAgICAgICAgIHZpZGVvVVJMOiBob3VzZURldGFpbERhdGEuVmlkZW8uVmlkZW9zWzBdLkNkbnNbMF0uVXJsXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgQVBQLnBhZ2UuaG91c2VWaWRlbyhkYXRhKTtcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIHJldHVybiBfZGVmaW5lUHJvcGVydHkoe1xuICAgICAgICByZXF1ZXN0OiByZXF1ZXN0LFxuICAgICAgICBnZXRIb3VzZXM6IGdldEhvdXNlcyxcbiAgICAgICAgZ2V0SG91c2VGYXZvdXJpdGVzOiBnZXRIb3VzZUZhdm91cml0ZXMsXG4gICAgICAgIGdldEhvdXNlVmlkZW86IGdldEhvdXNlVmlkZW8sXG4gICAgICAgIGdldEhvdXNlRGV0YWlsOiBnZXRIb3VzZURldGFpbCB9LCAnZ2V0SG91c2VEZXRhaWwnLCBnZXRIb3VzZURldGFpbCk7XG59KCk7XG4ndXNlIHN0cmljdCc7XG5cbi8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcblx0R0VPIExPQ0FUSU9OXG4qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovXG5BUFAuZ2VvID0gZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIGdldExvY2F0aW9uKCkge1xuICAgICAgICBpZiAobmF2aWdhdG9yLmdlb2xvY2F0aW9uKSB7XG4gICAgICAgICAgICBuYXZpZ2F0b3IuZ2VvbG9jYXRpb24uZ2V0Q3VycmVudFBvc2l0aW9uKF9kaXNwbGF5UG9zaXRpb24sIF9kaXNwbGF5RXJyb3IsIHtcbiAgICAgICAgICAgICAgICBlbmFibGVIaWdoQWNjdXJhY3k6IHRydWUsXG4gICAgICAgICAgICAgICAgbWF4aW11bUFnZTogMFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBmdW5jdGlvbiBfZGlzcGxheVBvc2l0aW9uKHBvc2l0aW9uKSB7XG4gICAgICAgIHZhciBncHNUb0NpdHkgPSBbJ2h0dHBzOi8vbm9taW5hdGltLm9wZW5zdHJlZXRtYXAub3JnL3JldmVyc2U/Zm9ybWF0PWpzb24mbGF0PScsICcmbG9uPSddLFxuICAgICAgICAgICAgbGF0ID0gcG9zaXRpb24uY29vcmRzLmxhdGl0dWRlLFxuICAgICAgICAgICAgbG9uID0gcG9zaXRpb24uY29vcmRzLmxvbmdpdHVkZSxcbiAgICAgICAgICAgIHpvb20gPSAnJnpvb209MTMmYWRkcmVzc2RldGFpbHM9MScsXG4gICAgICAgICAgICBDaXR5VXJsID0gZ3BzVG9DaXR5WzBdICsgbGF0ICsgZ3BzVG9DaXR5WzFdICsgbG9uICsgem9vbTtcblxuICAgICAgICBBUFAuZGF0YS5yZXF1ZXN0KENpdHlVcmwpLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICB2YXIgY2l0eURhdGEgPSBKU09OLnBhcnNlKHJlc3BvbnNlKTtcbiAgICAgICAgICAgIHZhciBjaXR5ID0gY2l0eURhdGEuYWRkcmVzcy5jaXR5IHx8IGNpdHlEYXRhLmFkZHJlc3MudG93bjtcbiAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdMb2NhdGlvbicsIGNpdHkpO1xuXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhjaXR5KTtcblxuICAgICAgICAgICAgQVBQLmRhdGEuZ2V0SG91c2VzKGNpdHkpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBfZGlzcGxheUVycm9yKCkge1xuICAgICAgICBjb25zb2xlLmxvZygnYW4gZXJyb3IgaGFzIG9jY3VyZWQnKTtcbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgICBnZXRMb2NhdGlvbjogZ2V0TG9jYXRpb25cbiAgICB9O1xufSgpO1xuJ3VzZSBzdHJpY3QnO1xuXG4vKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXG5cdFBBR0VTIFt3aXRoIHRlbXBsYXRpbmcgbGliOiBNdXN0YWNoZV1cbioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi9cbkFQUC5wYWdlID0gZnVuY3Rpb24gKCkge1xuICAgIHZhciBfbWFpblNlbGVjdG9yID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignbWFpbicpO1xuICAgIHZhciBfbG9hZGVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xvYWRlcicpO1xuXG4gICAgZnVuY3Rpb24gaG91c2VWaWRlbyhkYXRhKSB7XG4gICAgICAgIEFQUC5kYXRhLnJlcXVlc3QoJy4vZGlzdC90ZW1wbGF0ZXMvaG91c2UtdmlkZW9zLm1zdCcpLnRoZW4oZnVuY3Rpb24gKHRlbXBsYXRlKSB7XG4gICAgICAgICAgICBfbWFpblNlbGVjdG9yLmlubmVySFRNTCA9IE11c3RhY2hlLnJlbmRlcih0ZW1wbGF0ZSwgZGF0YSk7XG4gICAgICAgICAgICBfbG9hZGVyLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpO1xuXG4gICAgICAgICAgICBBUFAuc3RvcmFnZS5pbml0KCk7XG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICBmdW5jdGlvbiBob3VzZURldGFpbChkYXRhKSB7XG4gICAgICAgIEFQUC5kYXRhLnJlcXVlc3QoJy4vZGlzdC90ZW1wbGF0ZXMvaG91c2UtZGV0YWlsLm1zdCcpLnRoZW4oZnVuY3Rpb24gKHRlbXBsYXRlKSB7XG4gICAgICAgICAgICBfbWFpblNlbGVjdG9yLmlubmVySFRNTCA9IE11c3RhY2hlLnJlbmRlcih0ZW1wbGF0ZSwgZGF0YSk7XG4gICAgICAgICAgICBfbG9hZGVyLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpO1xuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgZnVuY3Rpb24gaG91c2VGYXZvdXJpdGVzKGRhdGEpIHtcblxuICAgICAgICBpZiAobG9jYWxTdG9yYWdlLmdldEl0ZW0oXCJob3VzZUlEXCIpICE9IG51bGwpIHtcbiAgICAgICAgICAgIHZhciBJRHMgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnaG91c2VJRCcpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdmFyIElEcyA9IFtdO1xuICAgICAgICB9XG5cbiAgICAgICAgLyogRmlsdGVyIElEICovXG4gICAgICAgIHZhciBkYXRhID0gZGF0YS5maWx0ZXIoZnVuY3Rpb24gKGMpIHtcbiAgICAgICAgICAgIHJldHVybiBJRHMuaW5kZXhPZihjLmlkKSAhPSAtMTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgY29uc29sZS5sb2coZGF0YSk7XG5cbiAgICAgICAgQVBQLmRhdGEucmVxdWVzdCgnLi9kaXN0L3RlbXBsYXRlcy9ob3VzZS1mYXZvdXJpdGVzLm1zdCcpLnRoZW4oZnVuY3Rpb24gKHRlbXBsYXRlKSB7XG4gICAgICAgICAgICBfbWFpblNlbGVjdG9yLmlubmVySFRNTCA9IE11c3RhY2hlLnJlbmRlcih0ZW1wbGF0ZSwgZGF0YSk7XG4gICAgICAgICAgICBfbG9hZGVyLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpO1xuXG4gICAgICAgICAgICBBUFAuc3RvcmFnZS5pbml0KCk7XG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICByZXR1cm4ge1xuICAgICAgICBob3VzZVZpZGVvOiBob3VzZVZpZGVvLFxuICAgICAgICBob3VzZURldGFpbDogaG91c2VEZXRhaWwsXG4gICAgICAgIGhvdXNlRmF2b3VyaXRlczogaG91c2VGYXZvdXJpdGVzXG4gICAgfTtcbn0oKTtcbid1c2Ugc3RyaWN0JztcblxuLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxuXHRST1VURVIgTU9EVUxFIFt3aXRoIHJvdXRlciBsaWI6IFJvdXRpZV1cbioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi9cbkFQUC5yb3V0ZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gaW5pdChob3VzZUlEcywgY2l0eSkge1xuICAgICAgICBpZiAoIXdpbmRvdy5sb2NhdGlvbi5oYXNoKSB7XG4gICAgICAgICAgICB3aW5kb3cubG9jYXRpb24gPSAnI3ZpZGVvSUQ9JyArIGhvdXNlSURzWzBdLmlkO1xuICAgICAgICB9XG4gICAgICAgIHJvdXRpZSh7XG4gICAgICAgICAgICAndmlkZW9JRD06SUQnOiBmdW5jdGlvbiB2aWRlb0lESUQoSUQpIHtcbiAgICAgICAgICAgICAgICBBUFAuZGF0YS5nZXRIb3VzZVZpZGVvKElELCBob3VzZUlEcyk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgJ2hvdXNlRGV0YWlsPTpJRCc6IGZ1bmN0aW9uIGhvdXNlRGV0YWlsSUQoSUQpIHtcbiAgICAgICAgICAgICAgICBBUFAuZGF0YS5nZXRIb3VzZURldGFpbChJRCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgJ2Zhdm91cml0ZXMnOiBmdW5jdGlvbiBmYXZvdXJpdGVzKCkge1xuICAgICAgICAgICAgICAgIEFQUC5kYXRhLmdldEhvdXNlRmF2b3VyaXRlcyhjaXR5KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIHJldHVybiB7XG4gICAgICAgIGluaXQ6IGluaXRcbiAgICB9O1xufSgpO1xuXCJ1c2Ugc3RyaWN0XCI7XG5cbkFQUC5zdG9yYWdlID0gZnVuY3Rpb24gKCkge1xuXHRmdW5jdGlvbiBpbml0KCkge1xuXHRcdC8vIHNyYzogaHR0cDovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy8zMDAwODExNC9ob3ctZG8taS1wcm9taXNpZnktbmF0aXZlLXhoclxuXHRcdC8qIExvY2FsIFN0b3JhZ2UgYXJyYXkgICovXG5cdFx0aWYgKGxvY2FsU3RvcmFnZS5nZXRJdGVtKFwiaG91c2VJRFwiKSA9PT0gbnVsbCB8fCBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShcImhvdXNlSURcIikgPT09IFwiXCIpIHtcblx0XHRcdHZhciBhcnJheUlEID0gW107XG5cdFx0fSBlbHNlIHtcblx0XHRcdHZhciBhcnJheUlEID0gSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnaG91c2VJRCcpKTtcblx0XHR9XG5cblx0XHQvLyBDcmVhdGUgYSBuZXcgdmFyaWFibGUgbmV3QXJyYXlJRCBmb3IgZHluYW1pYyBhZGRpbmcgZmF2b3VyaXRlcy5cblx0XHR2YXIgbmV3QXJyYXlJRCA9IGFycmF5SUQ7XG5cblx0XHQvLyBGaW5kIGJ1dHRvblxuXHRcdHZhciBfZmF2b3VyaXRlQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmZhdm91cml0ZS1idG4nKTtcblxuXHRcdC8vIENoZWNrIGlmIElEIGlzIHN0b3JlZCBpbiBhcnJheSBhbmQgbWFrZSBidXR0b24gYWN0aXZlXG5cdFx0W10uZm9yRWFjaC5jYWxsKG5ld0FycmF5SUQsIGZ1bmN0aW9uIChJRCkge1xuXHRcdFx0dmFyIF9mYXZvdXJpdGVCdXR0b25JRCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5mYXZvdXJpdGUtYnRuW3ZhbHVlPVwiJyArIElEICsgJ1wiXScpO1xuXHRcdFx0aWYgKF9mYXZvdXJpdGVCdXR0b25JRCkge1xuXHRcdFx0XHRfZmF2b3VyaXRlQnV0dG9uSUQuY2xhc3NMaXN0LmFkZCgnYWN0aXZlJyk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHQvLyBGYXZvdXJpdGUgYnV0dG9uIGV2ZW50bGlzdGVuZXJcblx0XHRbXS5mb3JFYWNoLmNhbGwoX2Zhdm91cml0ZUJ1dHRvbiwgZnVuY3Rpb24gKGJ1dHRvbikge1xuXHRcdFx0Ly92YXIgYnV0dG9uSUQgPSBidXR0b24uZ2V0QXR0cmlidXRlKCdkYXRhLWlkJyk7XG5cdFx0XHRidXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBzdG9yZUlELCBmYWxzZSk7XG5cdFx0fSk7XG5cblx0XHRmdW5jdGlvbiBzdG9yZUlEKGV2ZW50KSB7XG5cdFx0XHRldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0dmFyIGNsaWNrZWRJRCA9IHRoaXMuZ2V0QXR0cmlidXRlKCd2YWx1ZScpO1xuXHRcdFx0YXJyYXlJRC5wdXNoKGNsaWNrZWRJRCk7XG5cblx0XHRcdC8vIFJlbW92ZSBjbGFzc1xuXHRcdFx0dGhpcy5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTtcblxuXHRcdFx0LyogIENIRUNLIEZPUiBEVVBMSUNBVEVEIElEJ3MgLSBzcmM6IGh0dHBzOi8vanNmaWRkbGUubmV0L0J1bWJsZUIybmEvWHZnVGIvMS8gKi9cblx0XHRcdGZvciAodmFyIGggPSAwOyBoIDwgbmV3QXJyYXlJRC5sZW5ndGg7IGgrKykge1xuXHRcdFx0XHR2YXIgY3VySXRlbSA9IG5ld0FycmF5SURbaF0sXG5cdFx0XHRcdCAgICBmb3VuZENvdW50ID0gMDtcblx0XHRcdFx0Ly8gc2VhcmNoIGFycmF5IGZvciBpdGVtXG5cdFx0XHRcdGZvciAodmFyIGkgPSAwOyBpIDwgbmV3QXJyYXlJRC5sZW5ndGg7IGkrKykge1xuXHRcdFx0XHRcdGlmIChuZXdBcnJheUlEW2ldID09IGFycmF5SURbaF0pIGZvdW5kQ291bnQrKztcblx0XHRcdFx0fVxuXHRcdFx0XHRpZiAoZm91bmRDb3VudCA+IDEpIHtcblx0XHRcdFx0XHQvLyByZW1vdmUgcmVwZWF0ZWQgaXRlbSBmcm9tIG5ldyBhcnJheVxuXHRcdFx0XHRcdGZvciAodmFyIGogPSAwOyBqIDwgbmV3QXJyYXlJRC5sZW5ndGg7IGorKykge1xuXHRcdFx0XHRcdFx0aWYgKG5ld0FycmF5SURbal0gPT0gY3VySXRlbSkge1xuXHRcdFx0XHRcdFx0XHRuZXdBcnJheUlELnNwbGljZShqLCAxKTtcblx0XHRcdFx0XHRcdFx0aiA9IGogLSAxO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fTtcblxuXHRcdFx0Ly8gQ2hlY2sgaWYgSUQgaXMgc3RvcmVkIGluIGFycmF5IGFuZCBtYWtlIGJ1dHRvbiBhY3RpdmVcblx0XHRcdFtdLmZvckVhY2guY2FsbChuZXdBcnJheUlELCBmdW5jdGlvbiAoSUQpIHtcblx0XHRcdFx0dmFyIF9mYXZvdXJpdGVCdXR0b25JRCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5mYXZvdXJpdGUtYnRuW3ZhbHVlPVwiJyArIElEICsgJ1wiXScpO1xuXHRcdFx0XHRpZiAoX2Zhdm91cml0ZUJ1dHRvbklEKSB7XG5cdFx0XHRcdFx0X2Zhdm91cml0ZUJ1dHRvbklELmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblxuXHRcdFx0Ly92YXIgc3RvcmVBcnJheUlkID0gSlNPTi5zdHJpbmdpZnkobmV3QXJyYXlJRCk7XG5cdFx0XHRsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnaG91c2VJRCcsIEpTT04uc3RyaW5naWZ5KG5ld0FycmF5SUQpKTtcblx0XHR9O1xuXHR9O1xuXG5cdHJldHVybiB7XG5cdFx0aW5pdDogaW5pdFxuXHR9O1xufSgpOyIsIi8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcblx0TkFNRVNQQUNFXG4qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovXG52YXIgQVBQID0gQVBQIHx8IHt9O1xuJ3VzZSBzdHJpY3QnO1xuXG4vKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXG4gICAgTEFVTkNIIEFQUFxuKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqL1xuQVBQLmxhdW5jaGVyID0gKGZ1bmN0aW9uICgpIHtcblxuICAgIGZ1bmN0aW9uIGluaXQoKSB7XG4gICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJET01Db250ZW50TG9hZGVkXCIsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIEFQUC5nZW8uZ2V0TG9jYXRpb24oKTtcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIHJldHVybiB7XG4gICAgICAgIGluaXQ6IGluaXRcbiAgICB9O1xuXG59KCkpO1xuXG5BUFAubGF1bmNoZXIuaW5pdCgpO1xuIiwiLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxuXHREQVRBIFJFUVVFU1RcbioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi9cbkFQUC5kYXRhID0gKCAoY2l0eSkgPT4ge1xuICAgIGZ1bmN0aW9uIHJlcXVlc3QodXJsKSB7IC8vIHNyYzogaHR0cDovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy8zMDAwODExNC9ob3ctZG8taS1wcm9taXNpZnktbmF0aXZlLXhoclxuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICAgICAgdmFyIHhociA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xuICAgICAgICAgICAgeGhyLm9wZW4oJ0dFVCcsIHVybCwgdHJ1ZSk7XG4gICAgICAgICAgICB4aHIub25sb2FkID0gICgpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5zdGF0dXMgPj0gMjAwICYmIHRoaXMuc3RhdHVzIDwgMzAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUoeGhyLnJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICByZWplY3Qoe1xuICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiB0aGlzLnN0YXR1cyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1c1RleHQ6IHhoci5zdGF0dXNUZXh0XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICB4aHIub25lcnJvciA9ICAoKSA9PiB7XG4gICAgICAgICAgICAgICAgcmVqZWN0KHtcbiAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiB0aGlzLnN0YXR1cyxcbiAgICAgICAgICAgICAgICAgICAgc3RhdHVzVGV4dDogeGhyLnN0YXR1c1RleHRcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICB4aHIuc2VuZCgpO1xuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgZnVuY3Rpb24gZ2V0SG91c2VzKGNpdHkpIHtcbiAgICAgICAgdmFyIG9iamVjdFR5cGUgPSAnanNvbicsXG4gICAgICAgICAgICBhcGlLZXkgPSAnZTJkNjBlODg1Yjg3NDJkNGIwNjQ4MzAwZTM3MDNiZDcnLFxuICAgICAgICAgICAgdHlwZSA9ICdrb29wJyxcbiAgICAgICAgICAgIGNpdHkgPSBjaXR5LFxuICAgICAgICAgICAgcGFnZU51bWJlciA9ICcxJyxcbiAgICAgICAgICAgIHBhZ2VTaXplID0gJzI1JyxcbiAgICAgICAgICAgIGFwaVVSTCA9ICdodHRwOi8vZnVuZGEua3lyYW5kaWEubmwvZmVlZHMvQWFuYm9kLnN2Yy8nKyBvYmplY3RUeXBlICsgJy8nKyBhcGlLZXkgKyAnLz90eXBlPScgKyB0eXBlICsgJyZ6bz0vJyArIGNpdHkgKyAnJnBhZ2U9JyArIHBhZ2VOdW1iZXIgKyAnJnBhZ2VzaXplPScgKyBwYWdlU2l6ZSArICcnO1xuXG4gICAgICAgIHRoaXMucmVxdWVzdChhcGlVUkwpXG4gICAgICAgICAgICAudGhlbiggKHJlc3BvbnNlKSA9PiB7XG4gICAgICAgICAgICAgICAgdmFyIGhvdXNlRGF0YSA9IEpTT04ucGFyc2UocmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgIHZhciBob3VzZUlEcyA9IFtdO1xuXG4gICAgICAgICAgICAgICAgLy8gW10uZm9yRWFjaC5jYWxsKGhvdXNlRGF0YS5PYmplY3RzLChob3VzZSkgPT4ge1xuICAgICAgICAgICAgICAgIC8vICAgICBpZihob3VzZS5IZWVmdFZpZGVvID09IHRydWUpIHtcbiAgICAgICAgICAgICAgICAvLyAgICAgICAgIHZhciBJRHMgPSB7XG4gICAgICAgICAgICAgICAgLy8gICAgICAgICAgICAgaWQ6IGhvdXNlLklkXG4gICAgICAgICAgICAgICAgLy8gICAgICAgICB9O1xuICAgICAgICAgICAgICAgIC8vICAgICAgICAgaG91c2VJRHMucHVzaChJRHMpO1xuICAgICAgICAgICAgICAgIC8vICAgICB9XG4gICAgICAgICAgICAgICAgLy8gfSk7XG5cbiAgICAgICAgICAgICAgICBob3VzZURhdGEuT2JqZWN0cy5mb3JFYWNoKChob3VzZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZihob3VzZS5IZWVmdFZpZGVvID09IHRydWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBJRHMgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IGhvdXNlLklkXG4gICAgICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICAgICAgaG91c2VJRHMucHVzaChJRHMpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBBUFAucm91dGVyLmluaXQoaG91c2VJRHMsIGNpdHkpO1xuICAgICAgICAgICAgfSlcbiAgICB9O1xuXG4gICAgZnVuY3Rpb24gZ2V0SG91c2VGYXZvdXJpdGVzKGNpdHkpIHtcbiAgICAgICAgdmFyIG9iamVjdFR5cGUgPSAnanNvbicsXG4gICAgICAgICAgICBhcGlLZXkgPSAnZTJkNjBlODg1Yjg3NDJkNGIwNjQ4MzAwZTM3MDNiZDcnLFxuICAgICAgICAgICAgdHlwZSA9ICdrb29wJyxcbiAgICAgICAgICAgIGNpdHkgPSBjaXR5LFxuICAgICAgICAgICAgcGFnZU51bWJlciA9ICcxJyxcbiAgICAgICAgICAgIHBhZ2VTaXplID0gJzI1JyxcbiAgICAgICAgICAgIGFwaVVSTCA9ICdodHRwOi8vZnVuZGEua3lyYW5kaWEubmwvZmVlZHMvQWFuYm9kLnN2Yy8nKyBvYmplY3RUeXBlICsgJy8nKyBhcGlLZXkgKyAnLz90eXBlPScgKyB0eXBlICsgJyZ6bz0vJyArIGNpdHkgKyAnJnBhZ2U9JyArIHBhZ2VOdW1iZXIgKyAnJnBhZ2VzaXplPScgKyBwYWdlU2l6ZSArICcnO1xuXG4gICAgICAgIHRoaXMucmVxdWVzdChhcGlVUkwpXG4gICAgICAgICAgICAudGhlbiggKHJlc3BvbnNlKSA9PiB7XG4gICAgICAgICAgICAgICAgdmFyIGhvdXNlRGF0YSA9IEpTT04ucGFyc2UocmVzcG9uc2UpO1xuXG4gICAgICAgICAgICAgICAgdmFyIGRhdGEgPSBbXTtcblxuICAgICAgICAgICAgICAgIFtdLmZvckVhY2guY2FsbChob3VzZURhdGEuT2JqZWN0cywgZnVuY3Rpb24gKG9iamVjdCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgb2JqZWN0cyA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBvYmplY3QuSWQsXG4gICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogb2JqZWN0LkFkcmVzLFxuICAgICAgICAgICAgICAgICAgICAgICAgcGhvdG86IG9iamVjdC5Gb3RvTGFyZ2VzdCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHBvc3RhbGNvZGU6IG9iamVjdC5Qb3N0Y29kZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHBsYWNlOiBvYmplY3QuV29vbnBsYWF0cyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHByaWNlOiBvYmplY3QuUHJpanMuS29vcHByaWpzXG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgIGRhdGEucHVzaChvYmplY3RzKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIEFQUC5wYWdlLmhvdXNlRmF2b3VyaXRlcyhkYXRhKTtcbiAgICAgICAgICAgIH0pXG4gICAgfTtcblxuICAgIGZ1bmN0aW9uIGdldEhvdXNlRGV0YWlsKElEKSB7XG4gICAgICAgIHZhciBvYmplY3RUeXBlID0gJ2pzb24nLFxuICAgICAgICAgICAgYXBpS2V5ID0gJ2UyZDYwZTg4NWI4NzQyZDRiMDY0ODMwMGUzNzAzYmQ3JyxcbiAgICAgICAgICAgIElEID0gSUQsXG4gICAgICAgICAgICB0eXBlID0gJ2tvb3AnLFxuICAgICAgICAgICAgYXBpVVJMID0gJ2h0dHA6Ly9mdW5kYS5reXJhbmRpYS5ubC9mZWVkcy9BYW5ib2Quc3ZjLycgKyBvYmplY3RUeXBlICsgJy9kZXRhaWwvJyArIGFwaUtleSArICcvJyArIHR5cGUgKyAnLycgKyBJRCArICcvJztcblxuXG4gICAgICAgIHRoaXMucmVxdWVzdChhcGlVUkwpXG4gICAgICAgICAgICAudGhlbiggKHJlc3BvbnNlKSA9PiB7XG4gICAgICAgICAgICAgICAgdmFyIGhvdXNlRGF0YSA9IEpTT04ucGFyc2UocmVzcG9uc2UpO1xuXG4gICAgICAgICAgICAgICAgdmFyIGksIG1lZGlhLCBqLCBtZWRpYUl0ZW1zLCBsYXJnZVBob3Rvc1VybDtcbiAgICAgICAgICAgICAgICB2YXIgcGhvdG9zID0gW107XG4gICAgICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IGhvdXNlRGF0YS5NZWRpYS5sZW5ndGgtMTI7IGkrKykge1xuICAgICAgICAgICAgICAgICAgbWVkaWEgPSBob3VzZURhdGEuTWVkaWFbaV07XG4gICAgICAgICAgICAgICAgICBpZihtZWRpYS5NZWRpYUl0ZW1zWzNdICE9IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICAgIGxhcmdlUGhvdG9zVXJsID0gbWVkaWEuTWVkaWFJdGVtc1szXS5Vcmw7XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICBwaG90b3MucHVzaCh7cGhvdG86IGxhcmdlUGhvdG9zVXJsfSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdmFyIGRhdGEgPSBbXTtcbiAgICAgICAgICAgICAgICB2YXIgb2JqZWN0cyA9IHtcbiAgICAgICAgICAgICAgICAgICAgaWQ6IGhvdXNlRGF0YS5JbnRlcm5hbElkLFxuICAgICAgICAgICAgICAgICAgICB0aXRsZTogaG91c2VEYXRhLlRpdGVsc1swXS5PbXNjaHJpanZpbmcsXG4gICAgICAgICAgICAgICAgICAgIHBob3RvczogcGhvdG9zLFxuICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogaG91c2VEYXRhLlZvbGxlZGlnZU9tc2NocmlqdmluZyxcbiAgICAgICAgICAgICAgICAgICAgcHJpY2U6IGhvdXNlRGF0YS5Lb29wUHJpanMsXG4gICAgICAgICAgICAgICAgICAgIHVybDogaG91c2VEYXRhLlVSTFxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgZGF0YS5wdXNoKG9iamVjdHMpO1xuXG4gICAgICAgICAgICAgICAgQVBQLnBhZ2UuaG91c2VEZXRhaWwoZGF0YSk7XG4gICAgICAgICAgICB9KVxuXG4gICAgfTtcblxuICAgIGZ1bmN0aW9uIGdldEhvdXNlVmlkZW8oSUQsIGhvdXNlSURzKSB7XG4gICAgICAgIHZhciBvYmplY3RUeXBlID0gJ2pzb24nLFxuICAgICAgICAgICAgYXBpS2V5ID0gJ2UyZDYwZTg4NWI4NzQyZDRiMDY0ODMwMGUzNzAzYmQ3JyxcbiAgICAgICAgICAgIElEID0gSUQsXG4gICAgICAgICAgICB0eXBlID0gJ2tvb3AnLFxuICAgICAgICAgICAgYXBpVVJMID0gJ2h0dHA6Ly9mdW5kYS5reXJhbmRpYS5ubC9mZWVkcy9BYW5ib2Quc3ZjLycgKyBvYmplY3RUeXBlICsgJy9kZXRhaWwvJyArIGFwaUtleSArICcvJyArIHR5cGUgKyAnLycgKyBJRCArICcvJztcblxuXG4gICAgICAgIHRoaXMucmVxdWVzdChhcGlVUkwpXG4gICAgICAgICAgICAudGhlbiggKHJlc3BvbnNlKSA9PiB7XG4gICAgICAgICAgICAgICAgdmFyIGhvdXNlRGV0YWlsRGF0YSA9IEpTT04ucGFyc2UocmVzcG9uc2UpO1xuXG4gICAgICAgICAgICAgICAgLy8gR2V0IG5leHQgSUQgaW4gYXJyYXlcbiAgICAgICAgICAgICAgICB2YXIgbmV4dEl0ZW0gPSAoaWQpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGkgPSAwLFxuICAgICAgICAgICAgICAgICAgICBtYXggPSBob3VzZUlEcy5sZW5ndGg7XG5cbiAgICAgICAgICAgICAgICAgICAgZm9yIChpOyBpIDwgbWF4OyBpICs9IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChob3VzZUlEc1tpXS5pZCA9PT0gSUQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaG91c2VJRHNbaSArIDFdO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAnbm90IGZvdW5kJztcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgLy8gR2V0IHByZXYgSUQgaW4gYXJyYXlcbiAgICAgICAgICAgICAgICB2YXIgcHJldkl0ZW0gPSAoaWQpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGkgPSAwLFxuICAgICAgICAgICAgICAgICAgICBtYXggPSBob3VzZUlEcy5sZW5ndGg7XG5cbiAgICAgICAgICAgICAgICAgICAgZm9yKGk7IGkgPCBtYXg7IGkgKz0gMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGhvdXNlSURzW2ldLmlkID09PSBJRCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBob3VzZUlEc1tpIC0gMV07XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICdub3QgZm91bmQnO1xuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICB2YXIgbmV4dElEID0gbmV4dEl0ZW0oSUQpO1xuICAgICAgICAgICAgICAgIHZhciBwcmV2SUQgPSBwcmV2SXRlbShJRCk7XG5cbiAgICAgICAgICAgICAgICBpZihwcmV2SUQgPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBkYXRhID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IElELFxuICAgICAgICAgICAgICAgICAgICAgICAgbmV4dElEOiBuZXh0SUQuaWQsXG4gICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogaG91c2VEZXRhaWxEYXRhLlRpdGVsc1swXS5PbXNjaHJpanZpbmcsXG4gICAgICAgICAgICAgICAgICAgICAgICBidXlQcmljZTogaG91c2VEZXRhaWxEYXRhLlByaWpzLktvb3BwcmlqcyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHZpZGVvVVJMOiBob3VzZURldGFpbERhdGEuVmlkZW8uVmlkZW9zWzBdLkNkbnNbMF0uVXJsXG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmKG5leHRJRCA9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGRhdGEgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZDogSUQsXG4gICAgICAgICAgICAgICAgICAgICAgICBwcmV2SUQ6IHByZXZJRC5pZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiBob3VzZURldGFpbERhdGEuVGl0ZWxzWzBdLk9tc2NocmlqdmluZyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGJ1eVByaWNlOiBob3VzZURldGFpbERhdGEuUHJpanMuS29vcHByaWpzLFxuICAgICAgICAgICAgICAgICAgICAgICAgdmlkZW9VUkw6IGhvdXNlRGV0YWlsRGF0YS5WaWRlby5WaWRlb3NbMF0uQ2Ruc1swXS5VcmxcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZGF0YSA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBJRCxcbiAgICAgICAgICAgICAgICAgICAgICAgIG5leHRJRDogbmV4dElELmlkLFxuICAgICAgICAgICAgICAgICAgICAgICAgcHJldklEOiBwcmV2SUQuaWQsXG4gICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogaG91c2VEZXRhaWxEYXRhLlRpdGVsc1swXS5PbXNjaHJpanZpbmcsXG4gICAgICAgICAgICAgICAgICAgICAgICBidXlQcmljZTogaG91c2VEZXRhaWxEYXRhLlByaWpzLktvb3BwcmlqcyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHZpZGVvVVJMOiBob3VzZURldGFpbERhdGEuVmlkZW8uVmlkZW9zWzBdLkNkbnNbMF0uVXJsXG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgQVBQLnBhZ2UuaG91c2VWaWRlbyhkYXRhKTtcbiAgICAgICAgICAgIH0pXG4gICAgfTtcblxuICAgIHJldHVybiB7XG4gICAgICAgIHJlcXVlc3Q6IHJlcXVlc3QsXG4gICAgICAgIGdldEhvdXNlczogZ2V0SG91c2VzLFxuICAgICAgICBnZXRIb3VzZUZhdm91cml0ZXM6IGdldEhvdXNlRmF2b3VyaXRlcyxcbiAgICAgICAgZ2V0SG91c2VWaWRlbzogZ2V0SG91c2VWaWRlbyxcbiAgICAgICAgZ2V0SG91c2VEZXRhaWwsIGdldEhvdXNlRGV0YWlsXG4gICAgfTtcblxufSkoKTtcbiIsIi8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcblx0R0VPIExPQ0FUSU9OXG4qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovXG5BUFAuZ2VvID0gKCAoKSA9PiB7XG4gICAgZnVuY3Rpb24gZ2V0TG9jYXRpb24oKSB7XG4gICAgICAgIGlmIChuYXZpZ2F0b3IuZ2VvbG9jYXRpb24pIHtcbiAgICAgICAgICAgIG5hdmlnYXRvci5nZW9sb2NhdGlvbi5nZXRDdXJyZW50UG9zaXRpb24oXG4gICAgICAgICAgICAgICAgX2Rpc3BsYXlQb3NpdGlvbixcbiAgICAgICAgICAgICAgICBfZGlzcGxheUVycm9yLCB7XG4gICAgICAgICAgICAgICAgICAgIGVuYWJsZUhpZ2hBY2N1cmFjeTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgbWF4aW11bUFnZTogMFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBmdW5jdGlvbiBfZGlzcGxheVBvc2l0aW9uKHBvc2l0aW9uKSB7XG4gICAgICAgIHZhciBncHNUb0NpdHkgPSBbJ2h0dHBzOi8vbm9taW5hdGltLm9wZW5zdHJlZXRtYXAub3JnL3JldmVyc2U/Zm9ybWF0PWpzb24mbGF0PScsICcmbG9uPSddLFxuICAgICAgICAgICAgbGF0ID0gcG9zaXRpb24uY29vcmRzLmxhdGl0dWRlLFxuICAgICAgICAgICAgbG9uID0gcG9zaXRpb24uY29vcmRzLmxvbmdpdHVkZSxcbiAgICAgICAgICAgIHpvb20gPSAnJnpvb209MTMmYWRkcmVzc2RldGFpbHM9MScsXG4gICAgICAgICAgICBDaXR5VXJsID0gZ3BzVG9DaXR5WzBdICsgbGF0ICsgZ3BzVG9DaXR5WzFdICsgbG9uICsgem9vbTtcblxuICAgICAgICBBUFAuZGF0YS5yZXF1ZXN0KENpdHlVcmwpXG4gICAgICAgICAgICAudGhlbiggKHJlc3BvbnNlKSA9PiB7XG4gICAgICAgICAgICAgICAgdmFyIGNpdHlEYXRhID0gSlNPTi5wYXJzZShyZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgdmFyIGNpdHkgPSBjaXR5RGF0YS5hZGRyZXNzLmNpdHkgfHwgY2l0eURhdGEuYWRkcmVzcy50b3duO1xuICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdMb2NhdGlvbicsIGNpdHkpXG5cbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhjaXR5KTtcblxuICAgICAgICAgICAgICAgIEFQUC5kYXRhLmdldEhvdXNlcyhjaXR5KTtcbiAgICAgICAgICAgIH0pXG4gICAgfVxuXG4gICAgZnVuY3Rpb24gX2Rpc3BsYXlFcnJvcigpIHtcbiAgICAgICAgY29uc29sZS5sb2coJ2FuIGVycm9yIGhhcyBvY2N1cmVkJyk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHtcbiAgICAgICAgZ2V0TG9jYXRpb246IGdldExvY2F0aW9uXG4gICAgfTtcblxufSkoKTtcbiIsIi8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcblx0UEFHRVMgW3dpdGggdGVtcGxhdGluZyBsaWI6IE11c3RhY2hlXVxuKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqL1xuQVBQLnBhZ2UgPSAoICgpID0+IHtcbiAgICB2YXIgX21haW5TZWxlY3RvciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ21haW4nKTtcbiAgICB2YXIgX2xvYWRlciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsb2FkZXInKTtcblxuICAgIGZ1bmN0aW9uIGhvdXNlVmlkZW8oZGF0YSkge1xuICAgICAgICBBUFAuZGF0YS5yZXF1ZXN0KCcuL2Rpc3QvdGVtcGxhdGVzL2hvdXNlLXZpZGVvcy5tc3QnKVxuICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHRlbXBsYXRlKSB7XG4gICAgICAgICAgICAgICAgX21haW5TZWxlY3Rvci5pbm5lckhUTUwgPSBNdXN0YWNoZS5yZW5kZXIodGVtcGxhdGUsIGRhdGEpO1xuICAgICAgICAgICAgICAgIF9sb2FkZXIuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7XG5cbiAgICAgICAgICAgICAgICBBUFAuc3RvcmFnZS5pbml0KCk7XG4gICAgICAgICAgICB9KVxuICAgIH07XG5cbiAgICBmdW5jdGlvbiBob3VzZURldGFpbChkYXRhKSB7XG4gICAgICAgIEFQUC5kYXRhLnJlcXVlc3QoJy4vZGlzdC90ZW1wbGF0ZXMvaG91c2UtZGV0YWlsLm1zdCcpXG4gICAgICAgICAgICAudGhlbiggKHRlbXBsYXRlKSA9PiB7XG4gICAgICAgICAgICAgICAgX21haW5TZWxlY3Rvci5pbm5lckhUTUwgPSBNdXN0YWNoZS5yZW5kZXIodGVtcGxhdGUsIGRhdGEpO1xuICAgICAgICAgICAgICAgIF9sb2FkZXIuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7XG4gICAgICAgICAgICB9KVxuICAgIH07XG5cbiAgICBmdW5jdGlvbiBob3VzZUZhdm91cml0ZXMoZGF0YSkge1xuXG4gICAgICAgIGlmIChsb2NhbFN0b3JhZ2UuZ2V0SXRlbShcImhvdXNlSURcIikgIT0gbnVsbCkge1xuICAgICAgICAgICAgdmFyIElEcyA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdob3VzZUlEJyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB2YXIgSURzID0gW107XG4gICAgICAgIH1cblxuICAgICAgICAvKiBGaWx0ZXIgSUQgKi9cbiAgICAgICAgdmFyIGRhdGEgPSBkYXRhLmZpbHRlciggKGMpID0+IHtcbiAgICAgICAgICAgIHJldHVybiBJRHMuaW5kZXhPZihjLmlkKSAhPSAtMVxuICAgICAgICB9KTtcblxuICAgICAgICBjb25zb2xlLmxvZyhkYXRhKTtcblxuICAgICAgICBBUFAuZGF0YS5yZXF1ZXN0KCcuL2Rpc3QvdGVtcGxhdGVzL2hvdXNlLWZhdm91cml0ZXMubXN0JylcbiAgICAgICAgICAgIC50aGVuKCAodGVtcGxhdGUpID0+IHtcbiAgICAgICAgICAgICAgICBfbWFpblNlbGVjdG9yLmlubmVySFRNTCA9IE11c3RhY2hlLnJlbmRlcih0ZW1wbGF0ZSwgZGF0YSk7XG4gICAgICAgICAgICAgICAgX2xvYWRlci5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTtcblxuICAgICAgICAgICAgICAgIEFQUC5zdG9yYWdlLmluaXQoKTtcbiAgICAgICAgICAgIH0pXG4gICAgfTtcblxuICAgIHJldHVybiB7XG4gICAgICAgIGhvdXNlVmlkZW86IGhvdXNlVmlkZW8sXG4gICAgICAgIGhvdXNlRGV0YWlsOiBob3VzZURldGFpbCxcbiAgICAgICAgaG91c2VGYXZvdXJpdGVzOiBob3VzZUZhdm91cml0ZXNcbiAgICB9O1xuXG59KSgpO1xuIiwiLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxuXHRST1VURVIgTU9EVUxFIFt3aXRoIHJvdXRlciBsaWI6IFJvdXRpZV1cbioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi9cbkFQUC5yb3V0ZXIgPSAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIGluaXQgKGhvdXNlSURzLCBjaXR5KSB7XG4gICAgICAgIGlmICghd2luZG93LmxvY2F0aW9uLmhhc2gpIHtcbiAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbiA9ICcjdmlkZW9JRD0nICsgaG91c2VJRHNbMF0uaWQ7XG4gICAgICAgIH1cbiAgICAgICAgcm91dGllKHtcbiAgICAgICAgICAgICd2aWRlb0lEPTpJRCc6IGZ1bmN0aW9uKElEKSB7XG4gICAgICAgICAgICAgICAgQVBQLmRhdGEuZ2V0SG91c2VWaWRlbyhJRCwgaG91c2VJRHMpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICdob3VzZURldGFpbD06SUQnOiBmdW5jdGlvbihJRCkge1xuICAgICAgICAgICAgICAgIEFQUC5kYXRhLmdldEhvdXNlRGV0YWlsKElEKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAnZmF2b3VyaXRlcyc6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIEFQUC5kYXRhLmdldEhvdXNlRmF2b3VyaXRlcyhjaXR5KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIHJldHVybiB7XG4gICAgICAgIGluaXQ6IGluaXRcbiAgICB9O1xuXG59KSgpO1xuIiwiQVBQLnN0b3JhZ2UgPSAoICgpID0+IHtcblx0ZnVuY3Rpb24gaW5pdCgpIHsgLy8gc3JjOiBodHRwOi8vc3RhY2tvdmVyZmxvdy5jb20vcXVlc3Rpb25zLzMwMDA4MTE0L2hvdy1kby1pLXByb21pc2lmeS1uYXRpdmUteGhyXG5cdFx0LyogTG9jYWwgU3RvcmFnZSBhcnJheSAgKi9cblx0ICAgIGlmIChsb2NhbFN0b3JhZ2UuZ2V0SXRlbShcImhvdXNlSURcIikgPT09IG51bGwgfHwgbG9jYWxTdG9yYWdlLmdldEl0ZW0oXCJob3VzZUlEXCIpID09PSBcIlwiKSB7XG5cdCAgICAgICAgdmFyIGFycmF5SUQgPSBbXTtcblx0ICAgIH0gZWxzZSB7XG5cdCAgICAgICAgdmFyIGFycmF5SUQgPSBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdob3VzZUlEJykpO1xuXHQgICAgfVxuXG5cdFx0Ly8gQ3JlYXRlIGEgbmV3IHZhcmlhYmxlIG5ld0FycmF5SUQgZm9yIGR5bmFtaWMgYWRkaW5nIGZhdm91cml0ZXMuXG5cdCAgICB2YXIgbmV3QXJyYXlJRCA9IGFycmF5SUQ7XG5cblx0XHQvLyBGaW5kIGJ1dHRvblxuXHRcdHZhciBfZmF2b3VyaXRlQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmZhdm91cml0ZS1idG4nKTtcblxuXHRcdC8vIENoZWNrIGlmIElEIGlzIHN0b3JlZCBpbiBhcnJheSBhbmQgbWFrZSBidXR0b24gYWN0aXZlXG5cdFx0W10uZm9yRWFjaC5jYWxsKG5ld0FycmF5SUQsIChJRCkgPT4ge1xuXHRcdFx0dmFyIF9mYXZvdXJpdGVCdXR0b25JRCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5mYXZvdXJpdGUtYnRuW3ZhbHVlPVwiJyArIElEICsgJ1wiXScpO1xuXHRcdFx0aWYoX2Zhdm91cml0ZUJ1dHRvbklEKSB7XG5cdFx0XHRcdF9mYXZvdXJpdGVCdXR0b25JRC5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTtcblx0XHRcdH1cblx0IFx0fSk7XG5cblx0XHQvLyBGYXZvdXJpdGUgYnV0dG9uIGV2ZW50bGlzdGVuZXJcblx0XHRbXS5mb3JFYWNoLmNhbGwoX2Zhdm91cml0ZUJ1dHRvbiwgKGJ1dHRvbikgPT4ge1xuICAgICAgICAgICAgLy92YXIgYnV0dG9uSUQgPSBidXR0b24uZ2V0QXR0cmlidXRlKCdkYXRhLWlkJyk7XG4gICAgICAgICAgICBidXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBzdG9yZUlELCBmYWxzZSk7XG4gICAgICAgIH0pO1xuXG5cdFx0ZnVuY3Rpb24gc3RvcmVJRChldmVudCkge1xuXHRcdFx0ZXZlbnQucHJldmVudERlZmF1bHQoKVxuICAgICAgICAgICAgdmFyIGNsaWNrZWRJRCA9IHRoaXMuZ2V0QXR0cmlidXRlKCd2YWx1ZScpO1xuICAgICAgICAgICAgYXJyYXlJRC5wdXNoKGNsaWNrZWRJRCk7XG5cblx0XHRcdC8vIFJlbW92ZSBjbGFzc1xuXHRcdFx0dGhpcy5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTtcblxuXHRcdFx0LyogIENIRUNLIEZPUiBEVVBMSUNBVEVEIElEJ3MgLSBzcmM6IGh0dHBzOi8vanNmaWRkbGUubmV0L0J1bWJsZUIybmEvWHZnVGIvMS8gKi9cbiAgICAgICAgICAgIGZvciAodmFyIGggPSAwOyBoIDwgbmV3QXJyYXlJRC5sZW5ndGg7IGgrKykge1xuICAgICAgICAgICAgICAgIHZhciBjdXJJdGVtID0gbmV3QXJyYXlJRFtoXSxcbiAgICAgICAgICAgICAgICAgICAgZm91bmRDb3VudCA9IDA7XG4gICAgICAgICAgICAgICAgLy8gc2VhcmNoIGFycmF5IGZvciBpdGVtXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBuZXdBcnJheUlELmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChuZXdBcnJheUlEW2ldID09IGFycmF5SURbaF0pXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3VuZENvdW50Kys7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChmb3VuZENvdW50ID4gMSkge1xuICAgICAgICAgICAgICAgICAgICAvLyByZW1vdmUgcmVwZWF0ZWQgaXRlbSBmcm9tIG5ldyBhcnJheVxuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IG5ld0FycmF5SUQubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChuZXdBcnJheUlEW2pdID09IGN1ckl0ZW0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXdBcnJheUlELnNwbGljZShqLCAxKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBqID0gaiAtIDE7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuXG5cdFx0XHQvLyBDaGVjayBpZiBJRCBpcyBzdG9yZWQgaW4gYXJyYXkgYW5kIG1ha2UgYnV0dG9uIGFjdGl2ZVxuXHRcdFx0W10uZm9yRWFjaC5jYWxsKG5ld0FycmF5SUQsIChJRCkgPT4ge1xuXHRcdFx0XHR2YXIgX2Zhdm91cml0ZUJ1dHRvbklEID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmZhdm91cml0ZS1idG5bdmFsdWU9XCInICsgSUQgKyAnXCJdJyk7XG5cdFx0XHRcdGlmKF9mYXZvdXJpdGVCdXR0b25JRCkge1xuXHRcdFx0XHRcdF9mYXZvdXJpdGVCdXR0b25JRC5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cblx0XHRcdC8vdmFyIHN0b3JlQXJyYXlJZCA9IEpTT04uc3RyaW5naWZ5KG5ld0FycmF5SUQpO1xuXHRcdFx0bG9jYWxTdG9yYWdlLnNldEl0ZW0oJ2hvdXNlSUQnLCBKU09OLnN0cmluZ2lmeShuZXdBcnJheUlEKSk7XG5cdFx0fTtcbiAgICB9O1xuXG5cdHJldHVybiB7XG4gICAgICAgIGluaXQ6IGluaXRcbiAgICB9O1xuXG59KSgpO1xuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
